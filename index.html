<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinanceControl - Controle de Finanças Pessoais</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-dark: #18191B;
            --primary-teal: #0C757B;
            --primary-purple: #470E92;
        }

        body {
            background: linear-gradient(135deg, var(--primary-dark) 0%, #2a2b2f 100%);
            font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .shine-effect {
            position: relative;
            overflow: hidden;
        }

        .shine-effect::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .shine-effect:hover::before {
            left: 100%;
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }

        .slide-up {
            animation: slideUp 0.5s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse-glow {
            animation: pulseGlow 2s infinite;
        }

        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(12, 117, 123, 0.3); }
            50% { box-shadow: 0 0 30px rgba(12, 117, 123, 0.6); }
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-teal), var(--primary-purple));
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 0 12px rgba(139, 92, 246, 0.25), 0 0 24px rgba(139, 92, 246, 0.15);
        }

        .card-hover {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .card-hover:hover {
            transform: scale(1.02);
            border-color: rgba(139, 92, 246, 0.6);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
        }

        /* Modo Claro */
        .light-mode {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            color: #1f2937;
        }

        .light-mode .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 0, 0, 0.08);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .light-mode .card-hover:hover {
            transform: scale(1.02);
            border-color: rgba(139, 92, 246, 0.5);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.2);
        }

        .light-mode .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 0 12px rgba(139, 92, 246, 0.2), 0 0 24px rgba(139, 92, 246, 0.12);
        }

        .light-mode input, .light-mode select {
            background: #ffffff !important;
            border-color: #d1d5db !important;
            color: #1f2937 !important;
        }

        .light-mode input:hover, .light-mode select:hover {
            box-shadow: 0 0 8px rgba(139, 92, 246, 0.12), 0 0 16px rgba(139, 92, 246, 0.06);
        }

        .light-mode input:focus, .light-mode select:focus {
            box-shadow: 0 0 10px rgba(139, 92, 246, 0.15), 0 0 20px rgba(139, 92, 246, 0.08);
        }

        .light-mode .text-gray-300 {
            color: #6b7280 !important;
        }

        .light-mode .text-gray-400 {
            color: #9ca3af !important;
        }

        .light-mode .border-gray-600 {
            border-color: #d1d5db !important;
        }

        .light-mode .divide-gray-600 > * + * {
            border-color: #e5e7eb !important;
        }

        .light-mode .hover\\:bg-gray-700:hover {
            background-color: #f3f4f6 !important;
        }

        .light-mode .bg-gray-700 {
            background-color: #f9fafb !important;
        }

        .light-mode .bg-gray-600 {
            background-color: #e5e7eb !important;
        }

        .light-mode .hover\\:bg-gray-600:hover {
            background-color: #d1d5db !important;
        }

        .light-mode .placeholder-gray-400::placeholder {
            color: #9ca3af !important;
        }

        /* Melhorias adicionais para modo claro */
        .light-mode .text-white {
            color: #1f2937 !important;
        }

        .light-mode .bg-[#18191B] {
            background-color: #ffffff !important;
            border-color: #d1d5db !important;
        }

        /* Melhorar contraste dos textos nos modais */
        .light-mode h3 {
            color: #111827 !important;
        }

        .light-mode label {
            color: #374151 !important;
        }

        .light-mode .text-xs {
            color: #4b5563 !important;
        }

        .light-mode .text-sm {
            color: #374151 !important;
        }

        .light-mode .border-gray-600 {
            border-color: #d1d5db !important;
        }

        .light-mode .text-gray-300 {
            color: #6b7280 !important;
        }

        .light-mode .text-gray-400 {
            color: #9ca3af !important;
        }

        /* Melhorar contraste específico dos modais */
        .light-mode #backupModal .text-xs,
        .light-mode #transactionModal .text-xs {
            color: #4b5563 !important;
        }

        .light-mode #backupModal .text-sm,
        .light-mode #transactionModal .text-sm {
            color: #374151 !important;
        }

        .light-mode #backupModal strong,
        .light-mode #transactionModal strong {
            color: #111827 !important;
        }

        .light-mode #backupModal p,
        .light-mode #transactionModal p {
            color: #4b5563 !important;
        }

        /* Manter texto dos botões de ação branco no modo claro */
        .light-mode .btn-primary,
        .light-mode .bg-green-600,
        .light-mode .bg-blue-600,
        .light-mode .bg-purple-600,
        .light-mode .bg-yellow-600,
        .light-mode .bg-indigo-600,
        .light-mode .bg-red-600 {
            color: #ffffff !important;
        }

        /* Toggle de tema no header */
        .theme-toggle-active .theme-slider {
            transform: translateX(32px);
            background: linear-gradient(135deg, var(--primary-teal), var(--primary-purple));
            color: white;
        }

        .theme-toggle-active-mobile .theme-slider-mobile {
            transform: translateX(24px);
            background: linear-gradient(135deg, var(--primary-teal), var(--primary-purple));
            color: white;
        }

        .light-mode .theme-toggle-active .theme-slider {
            background: #f59e0b !important;
        }

        .light-mode .theme-toggle-active-mobile .theme-slider-mobile {
            background: #f59e0b !important;
        }

        .light-mode #themeToggle {
            background-color: #e5e7eb !important;
        }

        .light-mode #themeToggleMobile {
            background-color: #e5e7eb !important;
        }

        /* Hamburger Menu Animation */
        .hamburger-active .hamburger-line:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .hamburger-active .hamburger-line:nth-child(2) {
            opacity: 0;
        }

        .hamburger-active .hamburger-line:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }

        .light-mode .hamburger-line {
            background-color: #374151 !important;
        }

        /* Mobile Menu Animation */
        .mobile-menu-enter {
            animation: slideDown 0.3s ease-out forwards;
        }

        .mobile-menu-exit {
            animation: slideUp 0.3s ease-out forwards;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
                max-height: 0;
            }
            to {
                opacity: 1;
                transform: translateY(0);
                max-height: 300px;
            }
        }

        @keyframes slideUpMenu {
            from {
                opacity: 1;
                transform: translateY(0);
                max-height: 300px;
            }
            to {
                opacity: 0;
                transform: translateY(-10px);
                max-height: 0;
            }
        }

        /* Responsivo para mobile */
        @media (max-width: 640px) {
            .theme-toggle {
                bottom: 20px;
                left: 20px;
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }


    </style>
</head>
<body class="min-h-screen text-white">
    <!-- Main Header - FinanceControl -->
    <header class="glass-effect p-3 sm:p-4 lg:p-6 fade-in border-b border-gray-600">
        <div class="max-w-7xl mx-auto">
            <div class="flex items-center justify-between">
                <!-- Logo e Título à Esquerda -->
                <div class="flex items-center gap-2 sm:gap-3">
                    <h1 class="text-lg sm:text-2xl lg:text-3xl font-bold bg-gradient-to-r from-[#0C757B] to-[#470E92] bg-clip-text text-transparent">
                        <span class="hidden sm:inline">FinanceControl</span>
                        <span class="sm:hidden">Finance</span>
                    </h1>
                </div>
                
                <!-- Subtítulo no Centro -->
                <div class="hidden lg:block">
                    <p class="text-lg xl:text-xl text-gray-300 font-medium">Controle de Despesas e Receitas</p>
                </div>
                
                <!-- Botões Desktop (lg+) -->
                <div class="hidden lg:flex items-center gap-2">
                    <!-- Toggle de Tema -->
                    <div class="relative mr-3">
                        <button id="themeToggle" class="relative w-16 h-8 bg-gray-600 rounded-full transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-purple-500/25 focus:outline-none" title="Alternar tema">
                            <div id="themeSlider" class="absolute top-1 left-1 w-6 h-6 bg-white rounded-full shadow-md transition-all duration-300 flex items-center justify-center text-sm">
                            </div>
                        </button>
                    </div>
                    
                    <!-- Botão Exportar Excel -->
                    <button id="exportExcelBtn" class="bg-green-600 hover:bg-green-700 shine-effect px-6 py-3 rounded-lg font-semibold text-lg transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-green-500/25" title="Exportar para Excel">
                        Excel
                    </button>
                    
                    <!-- Botão Exportar JSON -->
                    <button id="exportJsonBtn" class="bg-blue-600 hover:bg-blue-700 shine-effect px-6 py-3 rounded-lg font-semibold text-lg transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-blue-500/25" title="Exportar para JSON">
                        JSON
                    </button>
                    
                    <!-- Botão Backup Supabase -->
                    <button id="backupBtn" class="bg-purple-600 hover:bg-purple-700 shine-effect px-6 py-3 rounded-lg font-semibold text-lg transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-purple-500/25" title="Backup Supabase">
                        Backup
                    </button>
                    
                    <button id="addTransactionBtn" class="btn-primary shine-effect px-6 py-3 rounded-lg font-semibold text-lg">
                        + Nova Transação
                    </button>
                </div>

                <!-- Botões Mobile/Tablet (até lg) -->
                <div class="flex lg:hidden items-center gap-2">
                    <!-- Toggle de Tema Mobile -->
                    <div class="relative">
                        <button id="themeToggleMobile" class="relative w-12 h-6 sm:w-14 sm:h-7 bg-gray-600 rounded-full transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-purple-500/25 focus:outline-none" title="Alternar tema">
                            <div id="themeSliderMobile" class="absolute top-0.5 left-0.5 w-5 h-5 sm:w-6 sm:h-6 bg-white rounded-full shadow-md transition-all duration-300 flex items-center justify-center text-xs sm:text-sm">
                            </div>
                        </button>
                    </div>
                    
                    <!-- Botão Nova Transação sempre visível -->
                    <button id="addTransactionBtnMobile" class="btn-primary shine-effect px-3 py-2 sm:px-4 sm:py-2.5 rounded-lg font-semibold text-sm sm:text-base">
                        <span class="hidden sm:inline">+ Nova</span>
                        <span class="sm:hidden">+</span>
                    </button>
                    
                    <!-- Botão Menu Hamburger -->
                    <button id="mobileMenuBtn" class="glass-effect p-2 sm:p-2.5 rounded-lg transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-purple-500/25" title="Menu">
                        <div class="w-5 h-5 sm:w-6 sm:h-6 flex flex-col justify-center items-center">
                            <span class="hamburger-line block w-full h-0.5 bg-white mb-1 transition-all duration-300"></span>
                            <span class="hamburger-line block w-full h-0.5 bg-white mb-1 transition-all duration-300"></span>
                            <span class="hamburger-line block w-full h-0.5 bg-white transition-all duration-300"></span>
                        </div>
                    </button>
                </div>
            </div>
            
            <!-- Subtítulo para telas menores -->
            <div class="lg:hidden mt-2 sm:mt-3 text-center">
                <p class="text-sm sm:text-base text-gray-300">Controle de Despesas e Receitas</p>
            </div>
        </div>

        <!-- Menu Mobile Dropdown -->
        <div id="mobileMenu" class="lg:hidden hidden mt-4 glass-effect rounded-xl p-4 mx-3 sm:mx-4 border border-gray-600">
            <div class="grid grid-cols-1 gap-3">
                <button id="exportExcelBtnMobile" class="bg-green-600 hover:bg-green-700 shine-effect px-4 py-3 rounded-lg font-semibold text-sm sm:text-base transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-green-500/25 flex items-center justify-center gap-2">
                    <span>Exportar Excel</span>
                </button>
                
                <button id="exportJsonBtnMobile" class="bg-blue-600 hover:bg-blue-700 shine-effect px-4 py-3 rounded-lg font-semibold text-sm sm:text-base transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-blue-500/25 flex items-center justify-center gap-2">
                    <span>Exportar JSON</span>
                </button>
                
                <button id="backupBtnMobile" class="bg-purple-600 hover:bg-purple-700 shine-effect px-4 py-3 rounded-lg font-semibold text-sm sm:text-base transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-purple-500/25 flex items-center justify-center gap-2">
                    <span>Backup Supabase</span>
                </button>
            </div>
        </div>
    </header>



    <!-- Dashboard Cards -->
    <section class="max-w-7xl mx-auto p-3 sm:p-4 lg:p-6 slide-up">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 lg:gap-6 mb-6 sm:mb-8">
            <!-- Saldo Total -->
            <div class="glass-effect p-4 sm:p-5 lg:p-6 rounded-xl card-hover">
                <div class="flex items-center justify-between">
                    <div class="min-w-0 flex-1">
                        <p class="text-gray-300 text-xs sm:text-sm">Saldo Total</p>
                        <p id="totalBalance" class="text-xl sm:text-2xl lg:text-3xl font-bold text-[#0C757B] truncate">R$ 0,00</p>
                    </div>
                </div>
            </div>

            <!-- Receitas -->
            <div class="glass-effect p-4 sm:p-5 lg:p-6 rounded-xl card-hover">
                <div class="flex items-center justify-between">
                    <div class="min-w-0 flex-1">
                        <p class="text-gray-300 text-xs sm:text-sm">Receitas</p>
                        <p id="totalIncome" class="text-xl sm:text-2xl lg:text-3xl font-bold text-green-400 truncate">R$ 0,00</p>
                    </div>
                </div>
            </div>

            <!-- Despesas -->
            <div class="glass-effect p-4 sm:p-5 lg:p-6 rounded-xl card-hover sm:col-span-2 lg:col-span-1">
                <div class="flex items-center justify-between">
                    <div class="min-w-0 flex-1">
                        <p class="text-gray-300 text-xs sm:text-sm">Despesas</p>
                        <p id="totalExpenses" class="text-xl sm:text-2xl lg:text-3xl font-bold text-red-400 truncate">R$ 0,00</p>
                    </div>
                </div>
            </div>
        </div>
    </section>



    <!-- Filtros -->
    <section class="max-w-7xl mx-auto px-3 sm:px-4 lg:px-6 mb-4 sm:mb-6">
        <div class="glass-effect p-3 sm:p-4 rounded-xl">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-3 sm:gap-4">
                <select id="filterType" class="bg-[#18191B] border border-gray-600 rounded-lg px-3 py-2 text-white text-sm sm:text-base transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-purple-500/15 focus:scale-105 focus:shadow-lg focus:shadow-purple-500/20">
                    <option value="">Todos os tipos</option>
                    <option value="receita">Receitas</option>
                    <option value="despesa">Despesas</option>
                </select>
                <select id="filterCategory" class="bg-[#18191B] border border-gray-600 rounded-lg px-3 py-2 text-white text-sm sm:text-base transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-purple-500/15 focus:scale-105 focus:shadow-lg focus:shadow-purple-500/20">
                    <option value="">Todas as categorias</option>
                </select>
                <select id="filterMonth" class="bg-[#18191B] border border-gray-600 rounded-lg px-3 py-2 text-white text-sm sm:text-base transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-purple-500/15 focus:scale-105 focus:shadow-lg focus:shadow-purple-500/20">
                    <option value="">Todos os meses</option>
                    <option value="0">Janeiro</option>
                    <option value="1">Fevereiro</option>
                    <option value="2">Março</option>
                    <option value="3">Abril</option>
                    <option value="4">Maio</option>
                    <option value="5">Junho</option>
                    <option value="6">Julho</option>
                    <option value="7">Agosto</option>
                    <option value="8">Setembro</option>
                    <option value="9">Outubro</option>
                    <option value="10">Novembro</option>
                    <option value="11">Dezembro</option>
                </select>
                <select id="filterYear" class="bg-[#18191B] border border-gray-600 rounded-lg px-3 py-2 text-white text-sm sm:text-base transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-purple-500/15 focus:scale-105 focus:shadow-lg focus:shadow-purple-500/20">
                    <option value="">Todos os anos</option>
                </select>
                <input type="text" id="searchInput" placeholder="Buscar transações..." 
                       class="bg-[#18191B] border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-400 text-sm sm:text-base sm:col-span-2 xl:col-span-2 transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-purple-500/15 focus:scale-105 focus:shadow-lg focus:shadow-purple-500/20">
            </div>
        </div>
    </section>

    <!-- Gráficos -->
    <section class="max-w-7xl mx-auto px-3 sm:px-4 lg:px-6 mb-6 sm:mb-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6">
            <!-- Gráfico de Linha - Receitas vs Despesas -->
            <div class="glass-effect p-4 sm:p-5 lg:p-6 rounded-xl card-hover">
                <h3 class="text-base sm:text-lg lg:text-xl font-semibold mb-3 sm:mb-4 text-center">
                    <span class="hidden sm:inline">Receitas vs Despesas (Últimos 6 meses)</span>
                    <span class="sm:hidden">Receitas vs Despesas</span>
                </h3>
                <div class="relative h-48 sm:h-56 lg:h-64">
                    <canvas id="lineChart"></canvas>
                </div>
            </div>

            <!-- Gráfico de Barras - Despesas por Categoria -->
            <div class="glass-effect p-4 sm:p-5 lg:p-6 rounded-xl card-hover">
                <h3 id="barChartTitle" class="text-base sm:text-lg lg:text-xl font-semibold mb-3 sm:mb-4 text-center">
                    <span class="hidden sm:inline">Despesas por Categoria</span>
                    <span class="sm:hidden">Por Categoria</span>
                </h3>
                <div class="relative h-48 sm:h-56 lg:h-64">
                    <canvas id="barChart"></canvas>
                </div>
            </div>

            <!-- Mini Gráfico Anual -->
            <div class="glass-effect p-4 sm:p-5 lg:p-6 rounded-xl card-hover">
                <h3 class="text-base sm:text-lg lg:text-xl font-semibold mb-3 sm:mb-4 text-center">
                    <span class="hidden sm:inline">Comparativo Anual</span>
                    <span class="sm:hidden">Anual</span>
                </h3>
                <div class="relative h-48 sm:h-56 lg:h-64">
                    <canvas id="yearlyChart"></canvas>
                </div>
                <div class="mt-3 sm:mt-4 text-center">
                    <div class="flex justify-center gap-2 sm:gap-4 text-xs sm:text-sm flex-wrap">
                        <div class="flex items-center gap-1 sm:gap-2">
                            <div class="w-2 h-2 sm:w-3 sm:h-3 rounded-full bg-[#0C757B]"></div>
                            <span>Saldo</span>
                        </div>
                        <div class="flex items-center gap-1 sm:gap-2">
                            <div class="w-2 h-2 sm:w-3 sm:h-3 rounded-full bg-green-400"></div>
                            <span>Receitas</span>
                        </div>
                        <div class="flex items-center gap-1 sm:gap-2">
                            <div class="w-2 h-2 sm:w-3 sm:h-3 rounded-full bg-red-400"></div>
                            <span>Despesas</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>



    <!-- Lista de Transações -->
    <section class="max-w-7xl mx-auto px-3 sm:px-4 lg:px-6 pb-4 sm:pb-6">
        <div class="glass-effect rounded-xl overflow-hidden">
            <div class="p-4 sm:p-5 lg:p-6 border-b border-gray-600">
                <h2 class="text-lg sm:text-xl font-semibold">Transações Recentes</h2>
            </div>
            <div id="transactionsList" class="divide-y divide-gray-600">
                <div class="p-6 sm:p-8 text-center text-gray-400">
                    <p class="text-sm sm:text-base">Nenhuma transação encontrada</p>
                    <p class="text-xs sm:text-sm mt-1">Adicione sua primeira transação para começar</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal de Backup Supabase -->
    <div id="backupModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm hidden items-center justify-center z-50 p-4">
        <div class="glass-effect p-4 sm:p-6 lg:p-8 rounded-2xl w-full max-w-sm sm:max-w-md slide-up">
            <h3 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-center">Backup Supabase</h3>
            
            <div class="space-y-4">
                <!-- Status da Configuração -->
                <div id="configStatus" class="p-3 rounded-lg border hidden">
                    <div class="flex items-center gap-2">
                        <span id="statusIcon">✅</span>
                        <span id="statusText">Configuração salva</span>
                    </div>
                </div>

                <!-- Configuração -->
                <div class="space-y-3">
                    <div>
                        <label class="block text-xs sm:text-sm font-medium mb-1 sm:mb-2">URL do Supabase</label>
                        <input type="url" id="supabaseUrl" placeholder="https://seu-projeto.supabase.co" 
                               class="w-full bg-[#18191B] border border-gray-600 rounded-lg px-3 py-2 sm:px-4 sm:py-3 text-white placeholder-gray-400 focus:border-[#0C757B] focus:outline-none transition-all duration-300 text-sm sm:text-base">
                    </div>

                    <div>
                        <label class="block text-xs sm:text-sm font-medium mb-1 sm:mb-2">Chave Anônima (anon key)</label>
                        <input type="password" id="supabaseKey" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." 
                               class="w-full bg-[#18191B] border border-gray-600 rounded-lg px-3 py-2 sm:px-4 sm:py-3 text-white placeholder-gray-400 focus:border-[#0C757B] focus:outline-none transition-all duration-300 text-sm sm:text-base">
                    </div>

                    <div>
                        <label class="block text-xs sm:text-sm font-medium mb-1 sm:mb-2">Nome da Tabela</label>
                        <input type="text" id="tableName" placeholder="transactions" value="transactions"
                               class="w-full bg-[#18191B] border border-gray-600 rounded-lg px-3 py-2 sm:px-4 sm:py-3 text-white placeholder-gray-400 focus:border-[#0C757B] focus:outline-none transition-all duration-300 text-sm sm:text-base">
                    </div>
                </div>

                <!-- Ações de Backup -->
                <div class="border-t border-gray-600 pt-4 space-y-3">
                    <div class="grid grid-cols-2 gap-2">
                        <button id="testConnectionBtn" class="bg-yellow-600 hover:bg-yellow-700 px-3 py-2 rounded-lg font-semibold text-sm transition-all duration-300 hover:scale-105">
                            Testar
                        </button>
                        <button id="saveConfigBtn" class="bg-green-600 hover:bg-green-700 px-3 py-2 rounded-lg font-semibold text-sm transition-all duration-300 hover:scale-105">
                            Salvar Config
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-2">
                        <button id="uploadBackupBtn" class="bg-blue-600 hover:bg-blue-700 px-3 py-2 rounded-lg font-semibold text-sm transition-all duration-300 hover:scale-105">
                            Enviar Backup
                        </button>
                        <button id="downloadBackupBtn" class="bg-indigo-600 hover:bg-indigo-700 px-3 py-2 rounded-lg font-semibold text-sm transition-all duration-300 hover:scale-105">
                            Baixar Backup
                        </button>
                    </div>
                </div>

                <!-- Informações -->
                <div class="text-xs text-gray-400 bg-gray-800 bg-opacity-50 p-3 rounded-lg">
                    <p class="mb-2"><strong>Como configurar:</strong></p>
                    <p>1. Acesse seu projeto no Supabase</p>
                    <p>2. Vá em Settings → API</p>
                    <p>3. Copie a URL e a chave anônima</p>
                    <p>4. Crie uma tabela 'transactions' no SQL Editor</p>
                </div>

                <!-- Botões de Ação -->
                <div class="flex gap-2 sm:gap-3 pt-3 sm:pt-4">
                    <button id="cancelBackupBtn" class="flex-1 bg-gray-600 hover:bg-gray-700 px-3 py-2 sm:px-4 sm:py-3 rounded-lg font-semibold transition-all duration-300 hover:scale-105 text-sm sm:text-base">
                        Fechar
                    </button>
                    <button id="createTableBtn" class="flex-1 bg-[#0C757B] hover:bg-[#470E92] px-3 py-2 sm:px-4 sm:py-3 rounded-lg font-semibold transition-all duration-300 hover:scale-105 text-sm sm:text-base">
                        SQL da Tabela
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Transação -->
    <div id="transactionModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm hidden items-center justify-center z-50 p-4">
        <div class="glass-effect p-4 sm:p-6 lg:p-8 rounded-2xl w-full max-w-sm sm:max-w-md slide-up">
            <h3 id="modalTitle" class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-center">Nova Transação</h3>
            
            <form id="transactionForm" class="space-y-3 sm:space-y-4">
                <div>
                    <label class="block text-xs sm:text-sm font-medium mb-1 sm:mb-2">Descrição</label>
                    <input type="text" id="description" required 
                           class="w-full bg-[#18191B] border border-gray-600 rounded-lg px-3 py-2 sm:px-4 sm:py-3 text-white placeholder-gray-400 focus:border-[#0C757B] focus:outline-none transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-purple-500/15 focus:scale-105 focus:shadow-lg focus:shadow-purple-500/20 text-sm sm:text-base">
                </div>

                <div>
                    <label class="block text-xs sm:text-sm font-medium mb-1 sm:mb-2">Valor</label>
                    <input type="number" id="amount" step="0.01" required 
                           class="w-full bg-[#18191B] border border-gray-600 rounded-lg px-3 py-2 sm:px-4 sm:py-3 text-white placeholder-gray-400 focus:border-[#0C757B] focus:outline-none transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-purple-500/15 focus:scale-105 focus:shadow-lg focus:shadow-purple-500/20 text-sm sm:text-base">
                </div>

                <div>
                    <label class="block text-xs sm:text-sm font-medium mb-1 sm:mb-2">Tipo</label>
                    <select id="type" required 
                            class="w-full bg-[#18191B] border border-gray-600 rounded-lg px-3 py-2 sm:px-4 sm:py-3 text-white focus:border-[#0C757B] focus:outline-none transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-purple-500/15 focus:scale-105 focus:shadow-lg focus:shadow-purple-500/20 text-sm sm:text-base">
                        <option value="">Selecione o tipo</option>
                        <option value="receita">Receita</option>
                        <option value="despesa">Despesa</option>
                    </select>
                </div>

                <div>
                    <label class="block text-xs sm:text-sm font-medium mb-1 sm:mb-2">Categoria</label>
                    <select id="category" required 
                            class="w-full bg-[#18191B] border border-gray-600 rounded-lg px-3 py-2 sm:px-4 sm:py-3 text-white focus:border-[#0C757B] focus:outline-none transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-purple-500/15 focus:scale-105 focus:shadow-lg focus:shadow-purple-500/20 text-sm sm:text-base">
                        <option value="">Selecione a categoria</option>
                    </select>
                </div>

                <div>
                    <label class="block text-xs sm:text-sm font-medium mb-1 sm:mb-2">Data</label>
                    <input type="date" id="date" required 
                           class="w-full bg-[#18191B] border border-gray-600 rounded-lg px-3 py-2 sm:px-4 sm:py-3 text-white focus:border-[#0C757B] focus:outline-none transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-purple-500/15 focus:scale-105 focus:shadow-lg focus:shadow-purple-500/20 text-sm sm:text-base">
                </div>

                <div class="flex gap-2 sm:gap-3 pt-3 sm:pt-4">
                    <button type="button" id="cancelBtn" 
                            class="flex-1 bg-gray-600 hover:bg-gray-700 px-3 py-2 sm:px-4 sm:py-3 rounded-lg font-semibold transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-purple-500/15 text-sm sm:text-base">
                        Cancelar
                    </button>
                    <button type="submit" 
                            class="flex-1 btn-primary shine-effect px-3 py-2 sm:px-4 sm:py-3 rounded-lg font-semibold text-sm sm:text-base">
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        class FinanceController {
            constructor() {
                this.transactions = JSON.parse(localStorage.getItem('transactions')) || [];
                this.editingId = null;
                this.categories = {
                    receita: ['Salário', 'Freelance', 'Investimentos', 'Vendas', 'Outros'],
                    despesa: ['Alimentação', 'Transporte', 'Moradia', 'Saúde', 'Educação', 'Lazer', 'Outros']
                };
                this.lineChart = null;
                this.barChart = null;
                this.yearlyChart = null;
                // Inicializar tema - padrão é modo escuro se não houver preferência salva
                const savedTheme = localStorage.getItem('darkMode');
                this.isDarkMode = savedTheme === null ? true : savedTheme === 'true';
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.updateCategoryOptions();
                this.updateYearOptions();
                this.renderTransactions();
                this.updateDashboard();
                this.applyTheme();

                this.setTodayDate();
                this.initCharts();
            }



            setupEventListeners() {
                // Transaction events - Desktop
                document.getElementById('addTransactionBtn')?.addEventListener('click', () => this.openModal());
                // Transaction events - Mobile
                document.getElementById('addTransactionBtnMobile')?.addEventListener('click', () => this.openModal());
                
                document.getElementById('cancelBtn').addEventListener('click', () => this.closeModal());
                document.getElementById('transactionForm').addEventListener('submit', (e) => this.handleSubmit(e));
                document.getElementById('type').addEventListener('change', () => this.updateCategoryOptions());
                document.getElementById('filterType').addEventListener('change', () => {
                    this.renderTransactions();
                    this.updateDashboard();
                    this.updateCharts();
                });
                document.getElementById('filterCategory').addEventListener('change', () => {
                    this.renderTransactions();
                    this.updateDashboard();
                    this.updateCharts();
                });
                document.getElementById('filterMonth').addEventListener('change', () => {
                    this.renderTransactions();
                    this.updateDashboard();
                    this.updateCharts();
                });
                document.getElementById('filterYear').addEventListener('change', () => {
                    this.renderTransactions();
                    this.updateDashboard();
                    this.updateCharts();
                });
                document.getElementById('searchInput').addEventListener('input', () => {
                    this.renderTransactions();
                    this.updateDashboard();
                    this.updateCharts();
                });
                
                // Export events - Desktop
                document.getElementById('exportExcelBtn')?.addEventListener('click', () => this.exportToExcel());
                document.getElementById('exportJsonBtn')?.addEventListener('click', () => this.exportToJson());
                
                // Export events - Mobile
                document.getElementById('exportExcelBtnMobile')?.addEventListener('click', () => {
                    this.exportToExcel();
                    this.closeMobileMenu();
                });
                document.getElementById('exportJsonBtnMobile')?.addEventListener('click', () => {
                    this.exportToJson();
                    this.closeMobileMenu();
                });
                
                // Backup events - Desktop
                document.getElementById('backupBtn')?.addEventListener('click', () => this.openBackupModal());
                // Backup events - Mobile
                document.getElementById('backupBtnMobile')?.addEventListener('click', () => {
                    this.openBackupModal();
                    this.closeMobileMenu();
                });
                
                document.getElementById('cancelBackupBtn').addEventListener('click', () => this.closeBackupModal());
                document.getElementById('saveConfigBtn').addEventListener('click', () => this.saveSupabaseConfig());
                document.getElementById('testConnectionBtn').addEventListener('click', () => this.testSupabaseConnection());
                document.getElementById('uploadBackupBtn').addEventListener('click', () => this.uploadToSupabase());
                document.getElementById('downloadBackupBtn').addEventListener('click', () => this.downloadFromSupabase());
                document.getElementById('createTableBtn').addEventListener('click', () => this.showCreateTableSQL());
                
                // Mobile menu events
                document.getElementById('mobileMenuBtn').addEventListener('click', () => this.toggleMobileMenu());
                
                // Theme toggle events
                document.getElementById('themeToggle')?.addEventListener('click', () => this.toggleTheme());
                document.getElementById('themeToggleMobile')?.addEventListener('click', () => this.toggleTheme());
                
                // Fechar modal clicando fora
                document.getElementById('transactionModal').addEventListener('click', (e) => {
                    if (e.target.id === 'transactionModal') this.closeModal();
                });
                document.getElementById('backupModal').addEventListener('click', (e) => {
                    if (e.target.id === 'backupModal') this.closeBackupModal();
                });
                
                // Fechar menu mobile ao clicar fora
                document.addEventListener('click', (e) => {
                    const mobileMenu = document.getElementById('mobileMenu');
                    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
                    
                    if (!mobileMenu.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                        this.closeMobileMenu();
                    }
                });

            }

            openModal(transaction = null) {
                this.editingId = transaction ? transaction.id : null;
                const modal = document.getElementById('transactionModal');
                const title = document.getElementById('modalTitle');
                
                title.textContent = transaction ? 'Editar Transação' : 'Nova Transação';
                
                if (transaction) {
                    document.getElementById('description').value = transaction.description;
                    document.getElementById('amount').value = Math.abs(transaction.amount);
                    document.getElementById('type').value = transaction.type;
                    document.getElementById('category').value = transaction.category;
                    document.getElementById('date').value = transaction.date;
                    this.updateCategoryOptions();
                } else {
                    document.getElementById('transactionForm').reset();
                    this.setTodayDate();
                }
                
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }

            closeModal() {
                const modal = document.getElementById('transactionModal');
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                this.editingId = null;
            }

            handleSubmit(e) {
                e.preventDefault();
                
                const formData = {
                    description: document.getElementById('description').value,
                    amount: parseFloat(document.getElementById('amount').value),
                    type: document.getElementById('type').value,
                    category: document.getElementById('category').value,
                    date: document.getElementById('date').value
                };

                if (this.editingId) {
                    this.updateTransaction(this.editingId, formData);
                } else {
                    this.addTransaction(formData);
                }
            }

            addTransaction(data) {
                const transaction = {
                    id: Date.now(),
                    ...data,
                    amount: data.type === 'despesa' ? -Math.abs(data.amount) : Math.abs(data.amount)
                };

                this.transactions.unshift(transaction);
                this.saveTransactions();
                this.updateYearOptions();
                this.renderTransactions();
                this.updateDashboard();
                this.updateCharts();
                this.closeModal();
                this.showNotification('Transação adicionada com sucesso!', 'success');
            }

            updateTransaction(id, data) {
                const index = this.transactions.findIndex(t => t.id === id);
                if (index !== -1) {
                    this.transactions[index] = {
                        ...this.transactions[index],
                        ...data,
                        amount: data.type === 'despesa' ? -Math.abs(data.amount) : Math.abs(data.amount)
                    };
                    this.saveTransactions();
                    this.updateYearOptions();
                    this.renderTransactions();
                    this.updateDashboard();
                    this.updateCharts();
                    this.closeModal();
                    this.showNotification('Transação atualizada com sucesso!', 'success');
                }
            }

            deleteTransaction(id) {
                if (confirm('Tem certeza que deseja excluir esta transação?')) {
                    this.transactions = this.transactions.filter(t => t.id !== id);
                    this.saveTransactions();
                    this.updateYearOptions();
                    this.renderTransactions();
                    this.updateDashboard();
                    this.updateCharts();
                    this.showNotification('Transação excluída com sucesso!', 'success');
                }
            }

            renderTransactions() {
                const container = document.getElementById('transactionsList');
                const filteredTransactions = this.getFilteredTransactions();

                if (filteredTransactions.length === 0) {
                    container.innerHTML = `
                        <div class="p-8 text-center text-gray-400">
                            <p>Nenhuma transação encontrada</p>
                            <p class="text-sm">Adicione sua primeira transação para começar</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = filteredTransactions.map(transaction => `
                    <div class="p-3 sm:p-4 hover:bg-white hover:bg-opacity-5 transition-all duration-300 hover:scale-101 hover:shadow-lg hover:shadow-purple-500/15">
                        <div class="flex items-center justify-between gap-3">
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2 sm:gap-3">
                                    <div class="min-w-0 flex-1">
                                        <h4 class="font-semibold text-sm sm:text-base truncate">${transaction.description}</h4>
                                        <p class="text-xs sm:text-sm text-gray-400 truncate">
                                            <span class="hidden sm:inline">${transaction.category} • ${this.formatDate(transaction.date)}</span>
                                            <span class="sm:hidden">${transaction.category}</span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center gap-2 sm:gap-4 flex-shrink-0">
                                <span class="text-sm sm:text-lg font-bold ${transaction.amount >= 0 ? 'text-green-400' : 'text-red-400'} text-right">
                                    <span class="hidden sm:inline">${this.formatCurrency(transaction.amount)}</span>
                                    <span class="sm:hidden">${this.formatCurrency(transaction.amount).replace('R$ ', 'R$')}</span>
                                </span>
                                <div class="flex gap-1 sm:gap-2">
                                    <button onclick="financeController.openModal(${JSON.stringify(transaction).replace(/"/g, '&quot;')})" 
                                            class="text-[#0C757B] hover:text-[#470E92] transition-all duration-300 hover:scale-125 hover:shadow-lg hover:shadow-purple-500/20 p-1 text-sm sm:text-base bg-gray-600 hover:bg-gray-700 rounded px-2 py-1">
                                        Editar
                                    </button>
                                    <button onclick="financeController.deleteTransaction(${transaction.id})" 
                                            class="text-red-400 hover:text-red-300 transition-all duration-300 hover:scale-125 hover:shadow-lg hover:shadow-red-500/20 p-1 text-sm sm:text-base bg-gray-600 hover:bg-gray-700 rounded px-2 py-1">
                                        Excluir
                                    </button>
                                </div>
                            </div>
                        </div>
                        <!-- Data para mobile -->
                        <div class="sm:hidden mt-2 text-xs text-gray-400">
                            ${this.formatDate(transaction.date)}
                        </div>
                    </div>
                `).join('');
            }

            getFilteredTransactions() {
                let filtered = [...this.transactions];
                
                const typeFilter = document.getElementById('filterType').value;
                const categoryFilter = document.getElementById('filterCategory').value;
                const monthFilter = document.getElementById('filterMonth').value;
                const yearFilter = document.getElementById('filterYear').value;
                const searchTerm = document.getElementById('searchInput').value.toLowerCase();

                if (typeFilter) {
                    filtered = filtered.filter(t => t.type === typeFilter);
                }

                if (categoryFilter) {
                    filtered = filtered.filter(t => t.category === categoryFilter);
                }

                if (monthFilter !== '') {
                    filtered = filtered.filter(t => {
                        const transactionDate = new Date(t.date);
                        return transactionDate.getMonth() === parseInt(monthFilter);
                    });
                }

                if (yearFilter) {
                    filtered = filtered.filter(t => {
                        const transactionDate = new Date(t.date);
                        return transactionDate.getFullYear() === parseInt(yearFilter);
                    });
                }

                if (searchTerm) {
                    filtered = filtered.filter(t => 
                        t.description.toLowerCase().includes(searchTerm) ||
                        t.category.toLowerCase().includes(searchTerm)
                    );
                }

                return filtered;
            }

            // Método para filtrar apenas por tipo, categoria e busca (sem mês/ano para gráficos temporais)
            getBaseFilteredTransactions() {
                let filtered = [...this.transactions];
                
                const typeFilter = document.getElementById('filterType').value;
                const categoryFilter = document.getElementById('filterCategory').value;
                const searchTerm = document.getElementById('searchInput').value.toLowerCase();

                if (typeFilter) {
                    filtered = filtered.filter(t => t.type === typeFilter);
                }

                if (categoryFilter) {
                    filtered = filtered.filter(t => t.category === categoryFilter);
                }

                if (searchTerm) {
                    filtered = filtered.filter(t => 
                        t.description.toLowerCase().includes(searchTerm) ||
                        t.category.toLowerCase().includes(searchTerm)
                    );
                }

                return filtered;
            }

            updateDashboard() {
                const filteredTransactions = this.getFilteredTransactions();
                const income = filteredTransactions.filter(t => t.amount > 0).reduce((sum, t) => sum + t.amount, 0);
                const expenses = filteredTransactions.filter(t => t.amount < 0).reduce((sum, t) => sum + Math.abs(t.amount), 0);
                const balance = income - expenses;

                document.getElementById('totalBalance').textContent = this.formatCurrency(balance);
                document.getElementById('totalIncome').textContent = this.formatCurrency(income);
                document.getElementById('totalExpenses').textContent = this.formatCurrency(expenses);
            }

            updateCategoryOptions() {
                const typeSelect = document.getElementById('type');
                const categorySelect = document.getElementById('category');
                const filterCategorySelect = document.getElementById('filterCategory');
                
                const selectedType = typeSelect.value;
                
                // Atualizar categorias no formulário
                categorySelect.innerHTML = '<option value="">Selecione a categoria</option>';
                if (selectedType && this.categories[selectedType]) {
                    this.categories[selectedType].forEach(category => {
                        categorySelect.innerHTML += `<option value="${category}">${category}</option>`;
                    });
                }

                // Atualizar categorias no filtro
                const allCategories = [...new Set([...this.categories.receita, ...this.categories.despesa])];
                filterCategorySelect.innerHTML = '<option value="">Todas as categorias</option>';
                allCategories.forEach(category => {
                    filterCategorySelect.innerHTML += `<option value="${category}">${category}</option>`;
                });
            }

            updateYearOptions() {
                const filterYearSelect = document.getElementById('filterYear');
                
                // Obter anos únicos das transações
                const years = [...new Set(this.transactions.map(t => new Date(t.date).getFullYear()))];
                years.sort((a, b) => b - a); // Ordenar do mais recente para o mais antigo
                
                // Se não há transações, adicionar o ano atual
                if (years.length === 0) {
                    years.push(new Date().getFullYear());
                }
                
                filterYearSelect.innerHTML = '<option value="">Todos os anos</option>';
                years.forEach(year => {
                    filterYearSelect.innerHTML += `<option value="${year}">${year}</option>`;
                });
            }

            setTodayDate() {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('date').value = today;
            }

            formatCurrency(amount) {
                return new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                }).format(amount);
            }

            formatDate(dateString) {
                return new Date(dateString + 'T00:00:00').toLocaleDateString('pt-BR');
            }

            saveTransactions() {
                localStorage.setItem('transactions', JSON.stringify(this.transactions));
            }

            initCharts() {
                this.createLineChart();
                this.createBarChart();
                this.createYearlyChart();
            }

            createLineChart() {
                const ctx = document.getElementById('lineChart').getContext('2d');
                const data = this.getLineChartData();
                
                this.lineChart = new Chart(ctx, {
                    type: 'line',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: this.isDarkMode ? '#ffffff' : '#374151',
                                    font: { size: 12 }
                                }
                            }
                        },
                        scales: {
                            x: {
                                ticks: { color: this.isDarkMode ? '#9ca3af' : '#6b7280' },
                                grid: { color: this.isDarkMode ? 'rgba(156, 163, 175, 0.2)' : 'rgba(107, 114, 128, 0.2)' }
                            },
                            y: {
                                ticks: { 
                                    color: this.isDarkMode ? '#9ca3af' : '#6b7280',
                                    callback: function(value) {
                                        return 'R$ ' + value.toLocaleString('pt-BR');
                                    }
                                },
                                grid: { color: this.isDarkMode ? 'rgba(156, 163, 175, 0.2)' : 'rgba(107, 114, 128, 0.2)' }
                            }
                        },
                        elements: {
                            line: {
                                tension: 0.4
                            },
                            point: {
                                radius: 6,
                                hoverRadius: 8
                            }
                        }
                    }
                });
            }

            createBarChart() {
                const ctx = document.getElementById('barChart').getContext('2d');
                const data = this.getBarChartData();
                
                this.barChart = new Chart(ctx, {
                    type: 'bar',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            x: {
                                ticks: { 
                                    color: this.isDarkMode ? '#9ca3af' : '#6b7280',
                                    maxRotation: 45
                                },
                                grid: { display: false }
                            },
                            y: {
                                ticks: { 
                                    color: this.isDarkMode ? '#9ca3af' : '#6b7280',
                                    callback: function(value) {
                                        return 'R$ ' + value.toLocaleString('pt-BR');
                                    }
                                },
                                grid: { color: this.isDarkMode ? 'rgba(156, 163, 175, 0.2)' : 'rgba(107, 114, 128, 0.2)' }
                            }
                        },
                        elements: {
                            bar: {
                                borderRadius: 8,
                                borderSkipped: false
                            }
                        }
                    }
                });
            }

            getLineChartData() {
                const months = [];
                const currentDate = new Date();
                const typeFilter = document.getElementById('filterType').value;
                
                // Gerar últimos 6 meses
                for (let i = 5; i >= 0; i--) {
                    const date = new Date(currentDate.getFullYear(), currentDate.getMonth() - i, 1);
                    months.push({
                        label: date.toLocaleDateString('pt-BR', { month: 'short', year: '2-digit' }),
                        year: date.getFullYear(),
                        month: date.getMonth()
                    });
                }

                // Obter transações filtradas (sem filtro de mês/ano para o gráfico de linha)
                const baseFilteredTransactions = this.getBaseFilteredTransactions();

                const datasets = [];

                // Se filtro é apenas receitas, mostrar apenas receitas
                if (typeFilter === 'receita') {
                    const incomeData = months.map(month => {
                        return baseFilteredTransactions
                            .filter(t => {
                                const tDate = new Date(t.date);
                                return t.amount > 0 && 
                                       tDate.getFullYear() === month.year && 
                                       tDate.getMonth() === month.month;
                            })
                            .reduce((sum, t) => sum + t.amount, 0);
                    });

                    datasets.push({
                        label: 'Receitas',
                        data: incomeData,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.2)',
                        fill: true,
                        borderWidth: 3
                    });
                }
                // Se filtro é apenas despesas, mostrar apenas despesas
                else if (typeFilter === 'despesa') {
                    const expenseData = months.map(month => {
                        return Math.abs(baseFilteredTransactions
                            .filter(t => {
                                const tDate = new Date(t.date);
                                return t.amount < 0 && 
                                       tDate.getFullYear() === month.year && 
                                       tDate.getMonth() === month.month;
                            })
                            .reduce((sum, t) => sum + Math.abs(t.amount), 0));
                    });

                    datasets.push({
                        label: 'Despesas',
                        data: expenseData,
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.2)',
                        fill: true,
                        borderWidth: 3
                    });
                }
                // Se não há filtro de tipo, mostrar ambos
                else {
                    const incomeData = months.map(month => {
                        return baseFilteredTransactions
                            .filter(t => {
                                const tDate = new Date(t.date);
                                return t.amount > 0 && 
                                       tDate.getFullYear() === month.year && 
                                       tDate.getMonth() === month.month;
                            })
                            .reduce((sum, t) => sum + t.amount, 0);
                    });

                    const expenseData = months.map(month => {
                        return Math.abs(baseFilteredTransactions
                            .filter(t => {
                                const tDate = new Date(t.date);
                                return t.amount < 0 && 
                                       tDate.getFullYear() === month.year && 
                                       tDate.getMonth() === month.month;
                            })
                            .reduce((sum, t) => sum + Math.abs(t.amount), 0));
                    });

                    datasets.push(
                        {
                            label: 'Receitas',
                            data: incomeData,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            fill: true,
                            borderWidth: 3
                        },
                        {
                            label: 'Despesas',
                            data: expenseData,
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            fill: true,
                            borderWidth: 3
                        }
                    );
                }

                return {
                    labels: months.map(m => m.label),
                    datasets: datasets
                };
            }

            getBarChartData() {
                const transactionsByCategory = {};
                const filteredTransactions = this.getFilteredTransactions();
                const typeFilter = document.getElementById('filterType').value;

                // Se filtro é receitas, mostrar receitas por categoria
                if (typeFilter === 'receita') {
                    filteredTransactions
                        .filter(t => t.amount > 0)
                        .forEach(t => {
                            transactionsByCategory[t.category] = (transactionsByCategory[t.category] || 0) + t.amount;
                        });
                }
                // Se filtro é despesas ou não há filtro, mostrar despesas por categoria
                else {
                    filteredTransactions
                        .filter(t => t.amount < 0)
                        .forEach(t => {
                            transactionsByCategory[t.category] = (transactionsByCategory[t.category] || 0) + Math.abs(t.amount);
                        });
                }

                const categories = Object.keys(transactionsByCategory);
                const values = Object.values(transactionsByCategory);

                // Cores diferentes para receitas e despesas
                const incomeColors = [
                    'rgba(16, 185, 129, 0.8)',
                    'rgba(34, 197, 94, 0.8)',
                    'rgba(59, 130, 246, 0.8)',
                    'rgba(139, 92, 246, 0.8)',
                    'rgba(168, 85, 247, 0.8)',
                    'rgba(236, 72, 153, 0.8)',
                    'rgba(245, 158, 11, 0.8)'
                ];

                const expenseColors = [
                    'rgba(12, 117, 123, 0.8)',
                    'rgba(71, 14, 146, 0.8)',
                    'rgba(239, 68, 68, 0.8)',
                    'rgba(245, 158, 11, 0.8)',
                    'rgba(139, 92, 246, 0.8)',
                    'rgba(236, 72, 153, 0.8)',
                    'rgba(16, 185, 129, 0.8)'
                ];

                const colors = typeFilter === 'receita' ? incomeColors : expenseColors;

                return {
                    labels: categories,
                    datasets: [{
                        data: values,
                        backgroundColor: colors.slice(0, categories.length),
                        borderColor: colors.slice(0, categories.length).map(color => color.replace('0.8', '1')),
                        borderWidth: 2
                    }]
                };
            }

            createYearlyChart() {
                const ctx = document.getElementById('yearlyChart').getContext('2d');
                const data = this.getYearlyChartData();
                
                this.yearlyChart = new Chart(ctx, {
                    type: 'line',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            x: {
                                ticks: { 
                                    color: this.isDarkMode ? '#9ca3af' : '#6b7280',
                                    font: { size: 10 }
                                },
                                grid: { display: false }
                            },
                            y: {
                                ticks: { 
                                    color: this.isDarkMode ? '#9ca3af' : '#6b7280',
                                    font: { size: 10 },
                                    callback: function(value) {
                                        return 'R$ ' + (value/1000).toFixed(0) + 'k';
                                    }
                                },
                                grid: { color: this.isDarkMode ? 'rgba(156, 163, 175, 0.1)' : 'rgba(107, 114, 128, 0.1)' }
                            }
                        },
                        elements: {
                            line: {
                                tension: 0.3
                            },
                            point: {
                                radius: 3,
                                hoverRadius: 5
                            }
                        }
                    }
                });
            }

            getYearlyChartData() {
                const currentYear = new Date().getFullYear();
                const typeFilter = document.getElementById('filterType').value;
                const months = [
                    'Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun',
                    'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'
                ];

                // Obter transações filtradas (sem filtro de mês/ano para o gráfico anual)
                const baseFilteredTransactions = this.getBaseFilteredTransactions();

                const monthlyData = months.map((month, index) => {
                    const income = baseFilteredTransactions
                        .filter(t => {
                            const tDate = new Date(t.date);
                            return t.amount > 0 && 
                                   tDate.getFullYear() === currentYear && 
                                   tDate.getMonth() === index;
                        })
                        .reduce((sum, t) => sum + t.amount, 0);

                    const expenses = Math.abs(baseFilteredTransactions
                        .filter(t => {
                            const tDate = new Date(t.date);
                            return t.amount < 0 && 
                                   tDate.getFullYear() === currentYear && 
                                   tDate.getMonth() === index;
                        })
                        .reduce((sum, t) => sum + Math.abs(t.amount), 0));

                    return {
                        income,
                        expenses,
                        balance: income - expenses
                    };
                });

                const datasets = [];

                // Se filtro é apenas receitas
                if (typeFilter === 'receita') {
                    datasets.push({
                        label: 'Receitas',
                        data: monthlyData.map(d => d.income),
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.2)',
                        fill: true,
                        borderWidth: 2
                    });
                }
                // Se filtro é apenas despesas
                else if (typeFilter === 'despesa') {
                    datasets.push({
                        label: 'Despesas',
                        data: monthlyData.map(d => d.expenses),
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.2)',
                        fill: true,
                        borderWidth: 2
                    });
                }
                // Se não há filtro de tipo, mostrar todos
                else {
                    datasets.push(
                        {
                            label: 'Saldo',
                            data: monthlyData.map(d => d.balance),
                            borderColor: '#0C757B',
                            backgroundColor: 'rgba(12, 117, 123, 0.1)',
                            fill: true,
                            borderWidth: 2
                        },
                        {
                            label: 'Receitas',
                            data: monthlyData.map(d => d.income),
                            borderColor: '#10b981',
                            backgroundColor: 'transparent',
                            borderWidth: 1.5,
                            borderDash: [5, 5]
                        },
                        {
                            label: 'Despesas',
                            data: monthlyData.map(d => d.expenses),
                            borderColor: '#ef4444',
                            backgroundColor: 'transparent',
                            borderWidth: 1.5,
                            borderDash: [3, 3]
                        }
                    );
                }

                return {
                    labels: months,
                    datasets: datasets
                };
            }

            updateCharts() {
                const typeFilter = document.getElementById('filterType').value;
                
                // Atualizar título do gráfico de barras
                const barChartTitle = document.getElementById('barChartTitle');
                if (typeFilter === 'receita') {
                    barChartTitle.innerHTML = `
                        <span class="hidden sm:inline">Receitas por Categoria</span>
                        <span class="sm:hidden">Por Categoria</span>
                    `;
                } else if (typeFilter === 'despesa') {
                    barChartTitle.innerHTML = `
                        <span class="hidden sm:inline">Despesas por Categoria</span>
                        <span class="sm:hidden">Por Categoria</span>
                    `;
                } else {
                    barChartTitle.innerHTML = `
                        <span class="hidden sm:inline">Despesas por Categoria</span>
                        <span class="sm:hidden">Por Categoria</span>
                    `;
                }

                if (this.lineChart) {
                    this.lineChart.data = this.getLineChartData();
                    this.lineChart.update('active');
                }
                
                if (this.barChart) {
                    this.barChart.data = this.getBarChartData();
                    this.barChart.update('active');
                }

                if (this.yearlyChart) {
                    this.yearlyChart.data = this.getYearlyChartData();
                    this.yearlyChart.update('active');
                }
                
                // Atualizar cores dos gráficos para o tema atual
                this.updateChartColors();
            }





            exportToExcel() {
                const filteredTransactions = this.getFilteredTransactions();
                
                if (filteredTransactions.length === 0) {
                    this.showNotification('Nenhuma transação para exportar!', 'error');
                    return;
                }

                // Preparar dados para Excel
                const excelData = filteredTransactions.map(transaction => ({
                    'Data': this.formatDate(transaction.date),
                    'Descrição': transaction.description,
                    'Categoria': transaction.category,
                    'Tipo': transaction.type === 'receita' ? 'Receita' : 'Despesa',
                    'Valor': Math.abs(transaction.amount).toFixed(2).replace('.', ','),
                    'Valor Formatado': this.formatCurrency(transaction.amount)
                }));

                // Adicionar resumo no final
                const income = filteredTransactions.filter(t => t.amount > 0).reduce((sum, t) => sum + t.amount, 0);
                const expenses = filteredTransactions.filter(t => t.amount < 0).reduce((sum, t) => sum + Math.abs(t.amount), 0);
                const balance = income - expenses;

                excelData.push({});
                excelData.push({
                    'Data': 'RESUMO',
                    'Descrição': '',
                    'Categoria': '',
                    'Tipo': '',
                    'Valor': '',
                    'Valor Formatado': ''
                });
                excelData.push({
                    'Data': 'Total Receitas',
                    'Descrição': '',
                    'Categoria': '',
                    'Tipo': '',
                    'Valor': income.toFixed(2).replace('.', ','),
                    'Valor Formatado': this.formatCurrency(income)
                });
                excelData.push({
                    'Data': 'Total Despesas',
                    'Descrição': '',
                    'Categoria': '',
                    'Tipo': '',
                    'Valor': expenses.toFixed(2).replace('.', ','),
                    'Valor Formatado': this.formatCurrency(expenses)
                });
                excelData.push({
                    'Data': 'Saldo Final',
                    'Descrição': '',
                    'Categoria': '',
                    'Tipo': '',
                    'Valor': balance.toFixed(2).replace('.', ','),
                    'Valor Formatado': this.formatCurrency(balance)
                });

                // Converter para CSV (compatível com Excel)
                const headers = Object.keys(excelData[0]);
                const csvContent = [
                    headers.join(';'),
                    ...excelData.map(row => 
                        headers.map(header => {
                            const value = row[header] || '';
                            // Escapar aspas duplas e envolver em aspas se contém vírgula ou ponto e vírgula
                            return value.toString().includes(';') || value.toString().includes(',') 
                                ? `"${value.toString().replace(/"/g, '""')}"` 
                                : value;
                        }).join(';')
                    )
                ].join('\n');

                // Adicionar BOM para UTF-8 (para caracteres especiais)
                const BOM = '\uFEFF';
                const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
                
                // Criar link de download
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                
                const now = new Date();
                const timestamp = now.toISOString().slice(0, 19).replace(/:/g, '-');
                link.setAttribute('download', `financas_${timestamp}.csv`);
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showNotification('Dados exportados para Excel com sucesso!', 'success');
            }

            exportToJson() {
                try {
                    const filteredTransactions = this.getFilteredTransactions();
                    
                    if (filteredTransactions.length === 0) {
                        this.showNotification('Nenhuma transação para exportar!', 'error');
                        return;
                    }

                    // Calcular resumo
                    const income = filteredTransactions.filter(t => t.amount > 0).reduce((sum, t) => sum + t.amount, 0);
                    const expenses = filteredTransactions.filter(t => t.amount < 0).reduce((sum, t) => sum + Math.abs(t.amount), 0);
                    const balance = income - expenses;

                    // Preparar dados JSON estruturados
                    const jsonData = {
                        exportInfo: {
                            exportDate: new Date().toISOString(),
                            totalTransactions: filteredTransactions.length,
                            dateRange: {
                                from: filteredTransactions.length > 0 ? 
                                    new Date(Math.min(...filteredTransactions.map(t => new Date(t.date).getTime()))).toISOString() : null,
                                to: filteredTransactions.length > 0 ? 
                                    new Date(Math.max(...filteredTransactions.map(t => new Date(t.date).getTime()))).toISOString() : null
                            }
                        },
                        summary: {
                            totalIncome: income,
                            totalExpenses: expenses,
                            balance: balance,
                            formattedSummary: {
                                totalIncome: this.formatCurrency(income),
                                totalExpenses: this.formatCurrency(expenses),
                                balance: this.formatCurrency(balance)
                            }
                        },
                        transactions: filteredTransactions.map(transaction => ({
                            id: transaction.id,
                            date: transaction.date,
                            formattedDate: this.formatDate(transaction.date),
                            description: transaction.description,
                            category: transaction.category,
                            type: transaction.type,
                            amount: transaction.amount,
                            formattedAmount: this.formatCurrency(transaction.amount),
                            isIncome: transaction.amount > 0
                        })),
                        categorySummary: this.getCategorySummary(filteredTransactions)
                    };

                    // Converter para JSON formatado
                    const jsonString = JSON.stringify(jsonData, null, 2);
                    
                    // Criar blob e download
                    const blob = new Blob([jsonString], { type: 'application/json;charset=utf-8;' });
                    const link = document.createElement('a');
                    const url = URL.createObjectURL(blob);
                    link.setAttribute('href', url);
                    
                    const now = new Date();
                    const timestamp = now.toISOString().slice(0, 19).replace(/:/g, '-');
                    link.setAttribute('download', `financas_${timestamp}.json`);
                    
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    // Limpar URL
                    URL.revokeObjectURL(url);
                    
                    this.showNotification('Dados exportados para JSON com sucesso!', 'success');
                } catch (error) {
                    console.error('Erro ao exportar JSON:', error);
                    this.showNotification('Erro ao exportar dados para JSON!', 'error');
                }
            }

            getCategorySummary(transactions) {
                const summary = {};
                
                transactions.forEach(transaction => {
                    if (!summary[transaction.category]) {
                        summary[transaction.category] = {
                            income: 0,
                            expenses: 0,
                            total: 0,
                            count: 0
                        };
                    }
                    
                    if (transaction.amount > 0) {
                        summary[transaction.category].income += transaction.amount;
                    } else {
                        summary[transaction.category].expenses += Math.abs(transaction.amount);
                    }
                    
                    summary[transaction.category].total += transaction.amount;
                    summary[transaction.category].count++;
                });

                // Adicionar valores formatados
                Object.keys(summary).forEach(category => {
                    summary[category].formattedIncome = this.formatCurrency(summary[category].income);
                    summary[category].formattedExpenses = this.formatCurrency(summary[category].expenses);
                    summary[category].formattedTotal = this.formatCurrency(summary[category].total);
                });

                return summary;
            }

            toggleTheme() {
                this.isDarkMode = !this.isDarkMode;
                localStorage.setItem('darkMode', this.isDarkMode);
                this.applyTheme();
                
                // Atualizar cores dos gráficos se existirem
                if (this.lineChart || this.barChart || this.yearlyChart) {
                    setTimeout(() => {
                        this.updateChartColors();
                        this.updateCharts();
                    }, 100);
                }
            }

            applyTheme() {
                const body = document.body;
                const themeToggle = document.getElementById('themeToggle');
                const themeToggleMobile = document.getElementById('themeToggleMobile');
                const themeSlider = document.getElementById('themeSlider');
                const themeSliderMobile = document.getElementById('themeSliderMobile');
                
                // Aplicar transição suave
                body.style.transition = 'all 0.3s ease';
                
                if (this.isDarkMode) {
                    body.classList.remove('light-mode');
                    
                    // Desktop toggle
                    if (themeToggle) {
                        themeToggle.classList.remove('theme-toggle-active');
                        themeToggle.title = 'Alternar para modo claro';
                    }
                    if (themeSlider) {
                        themeSlider.style.transform = 'translateX(0)';
                        themeSlider.style.background = 'white';
                        themeSlider.style.color = 'black';
                    }
                    
                    // Mobile toggle
                    if (themeToggleMobile) {
                        themeToggleMobile.classList.remove('theme-toggle-active-mobile');
                        themeToggleMobile.title = 'Alternar para modo claro';
                    }
                    if (themeSliderMobile) {
                        themeSliderMobile.style.transform = 'translateX(0)';
                        themeSliderMobile.style.background = 'white';
                        themeSliderMobile.style.color = 'black';
                    }
                } else {
                    body.classList.add('light-mode');
                    
                    // Desktop toggle
                    if (themeToggle) {
                        themeToggle.classList.add('theme-toggle-active');
                        themeToggle.title = 'Alternar para modo escuro';
                    }
                    if (themeSlider) {
                        themeSlider.style.transform = 'translateX(32px)';
                        themeSlider.style.background = '#f59e0b';
                        themeSlider.style.color = 'white';
                    }
                    
                    // Mobile toggle
                    if (themeToggleMobile) {
                        themeToggleMobile.classList.add('theme-toggle-active-mobile');
                        themeToggleMobile.title = 'Alternar para modo escuro';
                    }
                    if (themeSliderMobile) {
                        themeSliderMobile.style.transform = 'translateX(24px)';
                        themeSliderMobile.style.background = '#f59e0b';
                        themeSliderMobile.style.color = 'white';
                    }
                }
                
                // Remover transição após aplicar o tema
                setTimeout(() => {
                    body.style.transition = '';
                }, 300);
            }

            updateChartColors() {
                const textColor = this.isDarkMode ? '#ffffff' : '#374151';
                const tickColor = this.isDarkMode ? '#9ca3af' : '#6b7280';
                const gridColor = this.isDarkMode ? 'rgba(156, 163, 175, 0.2)' : 'rgba(107, 114, 128, 0.2)';

                // Atualizar cores do gráfico de linha
                if (this.lineChart) {
                    this.lineChart.options.plugins.legend.labels.color = textColor;
                    this.lineChart.options.scales.x.ticks.color = tickColor;
                    this.lineChart.options.scales.x.grid.color = gridColor;
                    this.lineChart.options.scales.y.ticks.color = tickColor;
                    this.lineChart.options.scales.y.grid.color = gridColor;
                    this.lineChart.update('none');
                }

                // Atualizar cores do gráfico de barras
                if (this.barChart) {
                    this.barChart.options.scales.x.ticks.color = tickColor;
                    this.barChart.options.scales.y.ticks.color = tickColor;
                    this.barChart.options.scales.y.grid.color = gridColor;
                    this.barChart.update('none');
                }

                // Atualizar cores do gráfico anual
                if (this.yearlyChart) {
                    this.yearlyChart.options.scales.x.ticks.color = tickColor;
                    this.yearlyChart.options.scales.y.ticks.color = tickColor;
                    this.yearlyChart.options.scales.y.grid.color = this.isDarkMode ? 'rgba(156, 163, 175, 0.1)' : 'rgba(107, 114, 128, 0.1)';
                    this.yearlyChart.update('none');
                }
            }

            // ===== MÉTODOS DE BACKUP SUPABASE =====
            
            openBackupModal() {
                const modal = document.getElementById('backupModal');
                this.loadSupabaseConfig();
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }

            closeBackupModal() {
                const modal = document.getElementById('backupModal');
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }

            loadSupabaseConfig() {
                const config = JSON.parse(localStorage.getItem('supabaseConfig') || '{}');
                document.getElementById('supabaseUrl').value = config.url || '';
                document.getElementById('supabaseKey').value = config.key || '';
                document.getElementById('tableName').value = config.tableName || 'transactions';
                
                if (config.url && config.key) {
                    this.showConfigStatus('✅', 'Configuração salva', 'success');
                }
            }

            saveSupabaseConfig() {
                const url = document.getElementById('supabaseUrl').value.trim();
                const key = document.getElementById('supabaseKey').value.trim();
                const tableName = document.getElementById('tableName').value.trim() || 'transactions';

                if (!url || !key) {
                    this.showNotification('❌ Preencha URL e chave do Supabase!', 'error');
                    return;
                }

                // Validar formato da URL
                if (!url.includes('supabase.co')) {
                    this.showNotification('❌ URL deve ser do Supabase (*.supabase.co)!', 'error');
                    return;
                }

                // Remover barra final se existir
                const cleanUrl = url.endsWith('/') ? url.slice(0, -1) : url;

                // Validar formato da chave
                if (!key.startsWith('eyJ')) {
                    this.showNotification('❌ Chave deve começar com "eyJ" (JWT token)!', 'error');
                    return;
                }

                // Validar nome da tabela
                if (!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(tableName)) {
                    this.showNotification('❌ Nome da tabela deve conter apenas letras, números e underscore!', 'error');
                    return;
                }

                const config = { 
                    url: cleanUrl, 
                    key, 
                    tableName,
                    savedAt: new Date().toISOString()
                };
                
                localStorage.setItem('supabaseConfig', JSON.stringify(config));
                
                this.showConfigStatus('✅', 'Configuração salva com sucesso!', 'success');
                this.showNotification('✅ Configuração do Supabase salva!', 'success');
            }

            async testSupabaseConnection() {
                const config = this.getSupabaseConfig();
                if (!config) return;

                this.showConfigStatus('🔄', 'Testando conexão...', 'loading');

                try {
                    // Primeiro testar se a URL está correta
                    const healthCheck = await fetch(`${config.url}/rest/v1/`, {
                        method: 'GET',
                        headers: {
                            'apikey': config.key,
                            'Authorization': `Bearer ${config.key}`
                        }
                    });

                    if (!healthCheck.ok) {
                        throw new Error(`Erro na URL ou chave: ${healthCheck.status} - Verifique se a URL termina sem '/' e se a chave está correta`);
                    }

                    // Testar acesso à tabela e verificar estrutura
                    const response = await fetch(`${config.url}/rest/v1/${config.tableName}?select=*&limit=1`, {
                        method: 'GET',
                        headers: {
                            'apikey': config.key,
                            'Authorization': `Bearer ${config.key}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.ok) {
                        // Verificar se a tabela tem a estrutura correta
                        const schemaCheck = await fetch(`${config.url}/rest/v1/${config.tableName}?select=id,description,amount,type,category,date&limit=0`, {
                            method: 'GET',
                            headers: {
                                'apikey': config.key,
                                'Authorization': `Bearer ${config.key}`,
                                'Content-Type': 'application/json'
                            }
                        });

                        if (schemaCheck.ok) {
                            this.showConfigStatus('✅', 'Conexão e estrutura OK!', 'success');
                            this.showNotification('✅ Conexão com Supabase funcionando! Tabela com estrutura correta.', 'success');
                        } else {
                            const errorText = await schemaCheck.text();
                            if (errorText.includes('column') && errorText.includes('does not exist')) {
                                this.showConfigStatus('⚠️', 'Estrutura da tabela incorreta', 'error');
                                this.showNotification(`❌ Tabela existe mas estrutura está incorreta. Clique em 'SQL da Tabela' para recriar.`, 'error');
                            } else {
                                throw new Error(`Erro na verificação da estrutura: ${errorText}`);
                            }
                        }
                    } else if (response.status === 404) {
                        this.showConfigStatus('⚠️', 'Tabela não encontrada', 'error');
                        this.showNotification(`❌ Tabela '${config.tableName}' não existe. Clique em 'SQL da Tabela' para criar.`, 'error');
                    } else {
                        const errorText = await response.text();
                        throw new Error(`HTTP ${response.status}: ${errorText}`);
                    }
                } catch (error) {
                    console.error('Erro na conexão:', error);
                    this.showConfigStatus('❌', 'Erro na conexão', 'error');
                    this.showNotification(`❌ Erro: ${error.message}`, 'error');
                }
            }

            async uploadToSupabase() {
                const config = this.getSupabaseConfig();
                if (!config) return;

                if (this.transactions.length === 0) {
                    this.showNotification('Nenhuma transação para enviar!', 'error');
                    return;
                }

                try {
                    this.showNotification('Enviando backup...', 'info');

                    // Primeiro verificar se a tabela existe
                    const checkTable = await fetch(`${config.url}/rest/v1/${config.tableName}?select=*&limit=1`, {
                        method: 'GET',
                        headers: {
                            'apikey': config.key,
                            'Authorization': `Bearer ${config.key}`
                        }
                    });

                    if (checkTable.status === 404) {
                        this.showNotification(`Tabela '${config.tableName}' não existe! Clique em 'SQL da Tabela' para criar.`, 'error');
                        return;
                    }

                    // Preparar dados para upload (apenas campos que existem na tabela)
                    const dataToUpload = this.transactions.map(t => ({
                        id: t.id,
                        description: t.description,
                        amount: parseFloat(t.amount),
                        type: t.type,
                        category: t.category,
                        date: t.date
                    }));

                    // Limpar dados existentes primeiro
                    const deleteResponse = await fetch(`${config.url}/rest/v1/${config.tableName}`, {
                        method: 'DELETE',
                        headers: {
                            'apikey': config.key,
                            'Authorization': `Bearer ${config.key}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    // Inserir novos dados em lotes (Supabase tem limite de payload)
                    const batchSize = 100;
                    let totalInserted = 0;

                    for (let i = 0; i < dataToUpload.length; i += batchSize) {
                        const batch = dataToUpload.slice(i, i + batchSize);
                        
                        const response = await fetch(`${config.url}/rest/v1/${config.tableName}`, {
                            method: 'POST',
                            headers: {
                                'apikey': config.key,
                                'Authorization': `Bearer ${config.key}`,
                                'Content-Type': 'application/json',
                                'Prefer': 'return=minimal'
                            },
                            body: JSON.stringify(batch)
                        });

                        if (!response.ok) {
                            const errorText = await response.text();
                            throw new Error(`Erro no lote ${Math.floor(i/batchSize) + 1}: ${response.status} - ${errorText}`);
                        }

                        totalInserted += batch.length;
                        
                        // Mostrar progresso para uploads grandes
                        if (dataToUpload.length > batchSize) {
                            this.showNotification(`Enviando... ${totalInserted}/${dataToUpload.length}`, 'info');
                        }
                    }

                    this.showNotification(`✅ Backup enviado! ${totalInserted} transações salvas no Supabase.`, 'success');
                    
                } catch (error) {
                    console.error('Erro no upload:', error);
                    this.showNotification(`❌ Erro no upload: ${error.message}`, 'error');
                }
            }

            async downloadFromSupabase() {
                const config = this.getSupabaseConfig();
                if (!config) return;

                try {
                    this.showNotification('Baixando backup...', 'info');

                    const response = await fetch(`${config.url}/rest/v1/${config.tableName}?select=*&order=date.desc`, {
                        method: 'GET',
                        headers: {
                            'apikey': config.key,
                            'Authorization': `Bearer ${config.key}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        
                        if (data.length === 0) {
                            this.showNotification('Nenhum backup encontrado no Supabase!', 'error');
                            return;
                        }

                        // Confirmar substituição
                        const confirmReplace = confirm(
                            `🔄 RESTAURAR BACKUP\n\n` +
                            `📊 Encontradas: ${data.length} transações no Supabase\n` +
                            `💾 Locais atuais: ${this.transactions.length} transações\n\n` +
                            `⚠️ Isso substituirá TODOS os seus dados locais!\n\n` +
                            '✅ Deseja continuar com a restauração?'
                        );

                        if (!confirmReplace) {
                            this.showNotification('Restauração cancelada pelo usuário.', 'info');
                            return;
                        }

                        // Converter dados do Supabase para formato local
                        this.transactions = data.map(item => ({
                            id: parseInt(item.id),
                            description: item.description,
                            amount: parseFloat(item.amount),
                            type: item.type,
                            category: item.category,
                            date: item.date
                        }));

                        // Ordenar por data (mais recente primeiro)
                        this.transactions.sort((a, b) => new Date(b.date) - new Date(a.date));

                        this.saveTransactions();
                        this.updateYearOptions();
                        this.renderTransactions();
                        this.updateDashboard();
                        this.updateCharts();

                        this.showNotification(`✅ Backup restaurado! ${data.length} transações carregadas do Supabase.`, 'success');
                        
                    } else if (response.status === 404) {
                        this.showNotification(`Tabela '${config.tableName}' não encontrada! Clique em 'SQL da Tabela' para criar.`, 'error');
                    } else {
                        const errorText = await response.text();
                        throw new Error(`HTTP ${response.status}: ${errorText}`);
                    }
                } catch (error) {
                    console.error('Erro no download:', error);
                    this.showNotification(`❌ Erro no download: ${error.message}`, 'error');
                }
            }

            showCreateTableSQL() {
                const sqlScript = `-- SQL para criar a tabela no Supabase
-- Execute este script no SQL Editor do Supabase

CREATE TABLE transactions (
    id BIGINT PRIMARY KEY,
    description TEXT NOT NULL,
    amount NUMERIC(12,2) NOT NULL,
    type TEXT NOT NULL,
    category TEXT NOT NULL,
    date DATE NOT NULL
);

-- Criar índices para melhor performance
CREATE INDEX idx_transactions_date ON transactions(date);
CREATE INDEX idx_transactions_type ON transactions(type);
CREATE INDEX idx_transactions_category ON transactions(category);

-- Habilitar RLS (Row Level Security)
ALTER TABLE transactions ENABLE ROW LEVEL SECURITY;

-- Criar política para permitir todas as operações
CREATE POLICY "Enable all operations" ON transactions
    FOR ALL USING (true) WITH CHECK (true);

-- Verificar se a tabela foi criada corretamente
SELECT column_name, data_type, is_nullable 
FROM information_schema.columns 
WHERE table_name = 'transactions' 
ORDER BY ordinal_position;`;

                // Copiar para clipboard
                navigator.clipboard.writeText(sqlScript).then(() => {
                    this.showNotification('✅ SQL copiado para a área de transferência!', 'success');
                }).catch(() => {
                    // Fallback: mostrar em alert
                    alert('SQL Script:\n\n' + sqlScript);
                });
            }

            getSupabaseConfig() {
                const config = JSON.parse(localStorage.getItem('supabaseConfig') || '{}');
                
                if (!config.url || !config.key) {
                    this.showNotification('Configure o Supabase primeiro!', 'error');
                    return null;
                }

                return {
                    url: config.url,
                    key: config.key,
                    tableName: config.tableName || 'transactions'
                };
            }

            showConfigStatus(icon, text, type) {
                const statusDiv = document.getElementById('configStatus');
                const statusIcon = document.getElementById('statusIcon');
                const statusText = document.getElementById('statusText');
                
                statusIcon.textContent = icon;
                statusText.textContent = text;
                
                statusDiv.className = `p-3 rounded-lg border ${
                    type === 'success' ? 'border-green-500 bg-green-500 bg-opacity-20' :
                    type === 'error' ? 'border-red-500 bg-red-500 bg-opacity-20' :
                    type === 'loading' ? 'border-yellow-500 bg-yellow-500 bg-opacity-20' :
                    'border-blue-500 bg-blue-500 bg-opacity-20'
                }`;
                
                statusDiv.classList.remove('hidden');
                
                // Auto-hide após 3 segundos para status de sucesso
                if (type === 'success') {
                    setTimeout(() => {
                        statusDiv.classList.add('hidden');
                    }, 3000);
                }
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `fixed top-4 right-4 p-4 rounded-lg text-white z-50 slide-up ${
                    type === 'success' ? 'bg-green-600' : 
                    type === 'error' ? 'bg-red-600' : 'bg-blue-600'
                }`;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }

            // ===== MÉTODOS DO MENU MOBILE =====
            
            toggleMobileMenu() {
                const mobileMenu = document.getElementById('mobileMenu');
                const mobileMenuBtn = document.getElementById('mobileMenuBtn');
                
                if (mobileMenu.classList.contains('hidden')) {
                    this.openMobileMenu();
                } else {
                    this.closeMobileMenu();
                }
            }

            openMobileMenu() {
                const mobileMenu = document.getElementById('mobileMenu');
                const mobileMenuBtn = document.getElementById('mobileMenuBtn');
                
                mobileMenu.classList.remove('hidden');
                mobileMenu.classList.add('mobile-menu-enter');
                mobileMenuBtn.classList.add('hamburger-active');
                
                // Remover classe de animação após completar
                setTimeout(() => {
                    mobileMenu.classList.remove('mobile-menu-enter');
                }, 300);
            }

            closeMobileMenu() {
                const mobileMenu = document.getElementById('mobileMenu');
                const mobileMenuBtn = document.getElementById('mobileMenuBtn');
                
                if (!mobileMenu.classList.contains('hidden')) {
                    mobileMenu.classList.add('mobile-menu-exit');
                    mobileMenuBtn.classList.remove('hamburger-active');
                    
                    setTimeout(() => {
                        mobileMenu.classList.add('hidden');
                        mobileMenu.classList.remove('mobile-menu-exit');
                    }, 300);
                }
            }
        }

        // Inicializar a aplicação
        const financeController = new FinanceController();
    </script>


<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9758b2c21457f1c1',t:'MTc1NjI2NzYwNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
